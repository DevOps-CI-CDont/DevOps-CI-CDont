name: Docker Image CD

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:

  build_frontend:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Build the Docker image for frontend
    - run: docker build -t frontend ./itu-minitwit/frontend
  
  build_backend:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Build the Docker image for backend
    - run: docker build -t backend ./itu-minitwit/backend
    
  login-digital-ocean:
    runs-on: ubuntu-latest

    steps:
    - name: Login to DigitalOcean Container Registry
      uses: docker/login-action@v1   
      with:
        registry: registry.digitalocean.com
        username: ${{ secrets.DIGITAL_OCEAN_REGISTRY }}
        password: ${{ secrets.DIGITAL_OCEAN_REGISTRY }}

        
  tag_frontend:
    runs-on: ubuntu-latest

    steps:
    - name: tag and push Docker image to DigitalOcean Container Registry
    - run: docker tag frontend:latest registry.digitalocean.com/cicdont-images/frontend:latest
    - run: docker push registry.digitalocean.com/cicdont-images/frontend:latest

  tag_backend:
    runs-on: ubuntu-latest

    steps:
    - name: tag and push Docker image to DigitalOcean Container Registry
    - run: docker tag backend:latest registry.digitalocean.com/cicdont-images/backend:latest
    - run: docker push registry.digitalocean.com/cicdont-images/backend:latest
  
  
